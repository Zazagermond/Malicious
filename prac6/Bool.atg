import library.*;
import java.util.*;

COMPILER Bool $CN
/* Boolean expression calculator
   P.D. Terry, modified by KL Bradshaw 2024 */

  static boolean[] mem = new boolean[26];

IGNORECASE

CHARACTERS
  letter     = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz" .
TOKENS
  variable   = letter .

COMMENTS FROM "(*" TO "*)"  NESTED
COMMENTS FROM "/*" TO "*/"  NESTED

IGNORE CHR(0) .. CHR(31)

PRODUCTIONS
  Bool                               	(. 	int index = 0;
						boolean aval = false;
						char var; 												for (int i = 0; i < 26; i++) mem[i] = false; .)
  = { ( Variable<out var>              	(. index = var - 'A'; .)
         "=" Expression<out aval>			(. mem[index] = aval; .)
	| "print" Expression<out aval> 		(. IO.writeLine(aval); .)
	   )
       ";"
    } EOF .

  Variable<out char var>
  = variable                         (. var = token.val.charAt(0); .)
  .

  Expression<out boolean bolval>	(.bolval=false;.)
  = Term<out bolval>
    { Or Term<out boolean aval>		(. bolval=bolval || aval;.)
    } .

  Term<out boolean bolval>	(.bolval=false;.)
  = Factor<out bolval>
    { [ And ] Factor<out boolean aval>		(. bolval= bolval && aval;.)
    } .

  Factor<out boolean boval>(.boval=false;.)
 /* Note that ' means not as a postfix operator, e.g. b'  means "not b" */
   =   "NOT" Factor<out boval> 		(.if  (boval==true){boval=false;}else{boval=true;}.)
    | Primary<out boval>
      { "'"
      } .

  Primary<out boolean Boloption>	(. Boloption=false;  .)
  =   True	(.Boloption=true;.)
    | False	(.Boloption=false;.)
   | variable								  		
    | "(" Expression <out Boloption> ")" .

  True  = "TRUE" | "1" .
  False = "FALSE" | "0" .
  And   = "AND" | "&&" | "." .
  Or    = "OR" | "||" | "+" .
END Bool.
